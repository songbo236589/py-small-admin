# 模块创建工具使用文档

## 概述

模块创建工具（create_module）是一个命令行工具，用于快速创建标准化的模块结构。该工具遵循项目的标准目录结构和代码规范，能够自动生成模块所需的所有基础文件和目录，大大提高开发效率。

## 功能特性

- 快速创建标准化的模块目录结构
- 自动生成模型、控制器、服务层、验证器等基础文件
- 提供模块列表功能，方便查看所有模块
- 智能的模块名称验证，避免命名冲突

## 安装依赖

模块创建工具使用 Python 标准库，无需额外安装依赖。确保已安装以下基础依赖：

```bash
pip install -r requirements.txt
```

主要相关依赖包括：

- `loguru==0.7.3` - 现代化的Python日志库（可选，用于日志输出）

## 使用方法

### 1. 创建新模块

创建基本模块结构：

```bash
python -m commands.create_module create --module user
```

### 2. 列出所有模块

列出所有模块：

```bash
python -m commands.create_module list
```

列出所有模块及其详细信息：

```bash
python -m commands.create_module list --detail
```

输出示例：

```
发现的模块:
------------------------------------------------------------
模块名称                 文件数
---------------------------------------------
admin                39
common               43
user                 5
---------------------------------------------
```

### 3. 验证模块结构

验证指定模块的结构是否完整：

```bash
python -m commands.create_module validate --module user
```

## 模块结构说明

创建的模块包含以下目录和文件：

```
Modules/{module_name}/
├── __init__.py
├── controllers/
│   ├── __init__.py
│   └── v1/
│       ├── __init__.py
│       └── {module}_controller.py
├── models/
│   ├── __init__.py
│   └── {module}_model.py
├── queues/
│   └── __init__.py
├── routes/
│   ├── __init__.py
│   └── {module}.py
├── seeds/
│   ├── __init__.py
│   └── {module}_seed.py (使用 --full 参数时创建)
├── services/
│   ├── __init__.py
│   └── {module}_service.py
├── tasks/
│   └── __init__.py
└── validators/
    ├── __init__.py
    └── {module}_validator.py
```

### 目录说明


| 目录              | 说明                               |
| ----------------- | ---------------------------------- |
| `controllers/v1/` | 控制器目录，包含API接口定义        |
| `models/`         | 数据模型目录，包含数据库表定义     |
| `queues/`         | 队列任务目录，用于异步任务处理     |
| `routes/`         | 路由目录，定义API路由              |
| `seeds/`          | 种子数据目录，包含初始数据（可选） |
| `services/`       | 服务层目录，包含业务逻辑           |
| `tasks/`          | 任务目录，包含定时任务等           |
| `validators/`     | 验证器目录，包含数据验证逻辑       |

### 文件说明


| 文件                     | 说明                                        |
| ------------------------ | ------------------------------------------- |
| `{module}_controller.py` | 控制器文件，定义API接口                     |
| `{module}_model.py`      | 模型文件，定义数据表结构                    |
| `{module}_service.py`    | 服务层文件，实现业务逻辑                    |
| `{module}_validator.py`  | 验证器文件，定义数据验证规则                |
| `{module}.py`            | 路由文件，定义API路由（只包含一个示例接口） |
| `{module}_seed.py`       | 种子数据文件，包含初始数据（可选）          |

## 模块名称规范

模块名称必须符合以下规范：

1. 必须以小写字母开头
2. 只能包含小写字母、数字和下划线
3. 不能是 Python 保留关键字
4. 不能与现有模块名称冲突

### 有效示例

- `user`
- `product`
- `order_management`
- `user_profile`

### 无效示例

- `User`（包含大写字母）
- `user-profile`（包含连字符）
- `1user`（以数字开头）
- `class`（Python 保留关键字）

## 命令参考


| 命令       | 参数                 | 说明         |
| ---------- | -------------------- | ------------ |
| `create`   | `--module/-m` (必需) | 创建新模块   |
| `list`     | `--detail` (可选)    | 列出所有模块 |
| `validate` | `--module/-m` (必需) | 验证模块结构 |

### 参数说明


| 参数          | 说明                 |
| ------------- | -------------------- |
| `--module/-m` | 指定模块名称（必需） |
| `--detail`    | 显示详细信息（可选） |

## 示例工作流

### 新模块开发流程

1. 创建模块：

```bash
python -m commands.create_module create --module product 
```

2. 验证模块结构：

```bash
python -m commands.create_module validate --module product
```

3. 初始化迁移系统（如需要）：

```bash
python -m commands.migrate init --module product
```

4. 创建迁移文件（如需要）：

```bash
python -m commands.migrate create --module product --message "创建产品表"
```

5. 执行迁移（如需要）：

```bash
python -m commands.migrate up --module product
```

6. 运行种子数据（如需要）：

```bash
python -m commands.seed run --module product
```

### 模块更新流程

1. 修改模型文件
2. 创建新的迁移文件
3. 执行迁移
4. 更新控制器、服务层等文件

## 注意事项

1. **模块名称规范**

   - 严格遵循模块命名规范
   - 使用有意义的名称，便于理解和维护
2. **文件修改**

   - 创建模块后，需要根据实际需求修改生成的文件
   - 路由文件只包含一个示例接口，需要添加更多接口
3. **数据库迁移**

   - 模块创建工具不包含 migrations 目录
   - 如需数据库迁移，请使用 `migrate.py` 工具单独初始化
4. **中间件管理**

   - 模块创建工具不包含 middleware 目录
   - 中间件通常在项目级别统一管理
5. **模块注册**

   - 创建模块后，需要在主应用中注册路由
   - 修改 `Modules/main.py` 文件，添加新模块的路由


## 常见问题

### 1. 模块名称无效

如果遇到模块名称无效的错误，请检查：

- 是否以小写字母开头
- 是否只包含小写字母、数字和下划线
- 是否是 Python 保留关键字

### 2. 模块已存在

如果模块已存在，可以使用 `--force` 参数强制覆盖：

```bash
python -m commands.create_module create --module user --force
```

### 3. 模块结构不完整

如果验证模块时提示结构不完整，请检查：

- 所有必需的目录是否存在
- 所有必需的文件是否存在
- `__init__.py` 文件是否正确创建

### 4. 如何添加数据库迁移

模块创建工具不包含迁移系统，如需添加：

```bash
# 初始化迁移系统
python -m commands.migrate init --module {module_name}

# 创建迁移文件
python -m commands.migrate create --module {module_name} --message "描述"

# 执行迁移
python -m commands.migrate up --module {module_name}
```

### 5. 如何注册模块路由

创建模块后，需要在 `Modules/main.py` 中注册路由：

```python
from Modules.{module_name}.routes.{module_name} import router as {module_name}_router

app.include_router({module_name}_router, prefix="/api/v1")
```


### 3. 集成到开发流程

可以将模块创建工具集成到开发流程中，例如：

- 在 CI/CD 流程中自动创建测试模块
- 在项目初始化脚本中创建基础模块
- 在代码生成器中集成模块创建功能

## 相关文档

- [数据库迁移使用文档](./数据库迁移使用文档.md)
- [数据库填充使用文档](./数据库填充使用文档.md)
- [config使用文档](./config使用文档.md)

## 技术支持

如果在使用过程中遇到问题，请：

1. 检查本文档的常见问题部分
2. 查看相关文档
3. 检查日志输出
4. 联系技术支持团队

## 更新日志

### v1.0.0 (2026-01-09)

- 初始版本发布
- 支持创建基本模块结构
- 支持创建完整模块结构（包含种子数据）
- 支持模块列表和验证功能
- 支持强制覆盖已存在的模块
