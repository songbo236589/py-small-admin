# ===================================================================
# RabbitMQ 配置文件 - Py Small Admin
# ===================================================================
# 说明:
# - 此配置文件用于优化RabbitMQ性能和功能
# - 适用于Docker环境的RabbitMQ 3.12
# - 可根据实际需求调整配置参数
# ===================================================================

# ===================================================================
# 网络配置
# ===================================================================

# 监听所有网络接口
listeners.tcp.default = 5672

# 管理界面端口（management插件）
management.tcp.port = 15672

# 监听地址
listeners.tcp.default = 0.0.0.0
management.tcp.ip = 0.0.0.0

# ===================================================================
# 内存和磁盘配置
# ===================================================================

# 内存警报阈值（RAM的40%）
vm_memory_high_watermark.relative = 0.4

# 内存低水位线（RAM的20%）
vm_memory_high_watermark_paging_ratio = 0.5

# 磁盘空间限制（字节）
# 默认为 {mem_relative, 1.0}，即与内存大小相同
# 可以设置为绝对值，如 10GB = 10737418240
disk_free_limit.relative = 2.0

# 磁盘警报阈值（磁盘空间的50%）
disk_free_limit.absolute = 2GB

# ===================================================================
# 连接和通道配置
# ===================================================================

# 最大连接数
# 根据服务器性能调整，默认为无限制
# 建议值：1000-10000
channel_max = 2048

# 每个连接的最大通道数
channel_operation_timeout = 15000

# 心跳超时时间（秒）
heartbeat = 60

# 连接超时时间（秒）
connection_max = infinity

# ===================================================================
# 队列配置
# ===================================================================

# 队列模式
# lazy: 惰性队列，消息存储在磁盘，减少内存使用
# default: 默认模式，消息存储在内存
default_queue_mode = default

# 队列最大长度
# 设置为0表示无限制
queue_max_length = 0

# 队列最大字节数
# 设置为0表示无限制
queue_max_bytes = 0

# 队列消息TTL（毫秒）
# 设置为0表示消息永不过期
# 建议值：86400000（24小时）
message_ttl = 0

# 队列消息过期时间（毫秒）
# 设置为0表示队列永不过期
queue_expires = 0

# ===================================================================
# 消息持久化配置
# ===================================================================

# 消息持久化
# true: 消息持久化到磁盘（推荐）
# false: 消息仅存储在内存
disk_free_limit.absolute = 2GB

# 同步写入磁盘
# true: 每条消息都同步写入（最安全，性能最差）
# false: 异步写入（性能好，可能丢失数据）
# 建议值：true（生产环境）
disk_free_limit.absolute = 2GB

# ===================================================================
# 集群配置（如需集群，取消注释以下配置）
# ===================================================================

# cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config
# cluster_partition_handling = autoheal
# cluster_name = py-small-admin-cluster

# ===================================================================
# 联邦配置（如需联邦，取消注释以下配置）
# ===================================================================

# federation_upstream = "upstream-host"
# federation_upstream_username = "username"
# federation_upstream_password = "password"

# ===================================================================
# 插件配置
# ===================================================================

# 启用的插件列表
# management: 管理界面插件
# management_agent: 管理代理插件
# rabbitmq_management: Web管理界面
# rabbitmq_shovel: Shovel插件
# rabbitmq_federation: 联邦插件
# rabbitmq_stomp: STOMP协议支持
# rabbitmq_mqtt: MQTT协议支持
# rabbitmq_amqp1_0: AMQP 1.0协议支持
# rabbitmq_tracing: 消息追踪
# rabbitmq_top: 消息队列监控
# rabbitmq_delayed_message_exchange: 延迟消息插件
enabled_plugins = [
    rabbitmq_management,
    rabbitmq_shovel,
    rabbitmq_federation,
    rabbitmq_stomp,
    rabbitmq_mqtt,
    rabbitmq_amqp1_0
]

# ===================================================================
# 日志配置
# ===================================================================

# 日志级别
# debug: 调试信息
# info: 一般信息（推荐）
# warning: 警告信息
# error: 错误信息
log.console.level = info

# 日志文件路径
log.file.level = info

# 日志文件路径
log.dir = /var/log/rabbitmq

# 日志文件格式
# text: 文本格式
# json: JSON格式
log.file.format = text

# 日志文件轮转
# true: 启用日志轮转
log.file.rotation.date = $D0
log.file.rotation.size = 104857600
log.file.rotation.count = 10

# ===================================================================
# 监控和统计
# ===================================================================

# 收集统计信息
# true: 启用统计（推荐）
# false: 禁用统计（提高性能）
collect_statistics_interval = 5000

# 统计信息保留时间（毫秒）
# 建议值：3600000（1小时）
statistics_db_mode = private

# ===================================================================
# 安全配置
# ===================================================================

# SSL/TLS配置（如需SSL，取消注释以下配置）
# listeners.ssl.default = 5671
# ssl_options.verify = verify_peer
# ssl_options.fail_if_no_peer_cert = false
# ssl_options.cacertfile = /etc/rabbitmq/ca_certificate.pem
# ssl_options.certfile = /etc/rabbitmq/server_certificate.pem
# ssl_options.keyfile = /etc/rabbitmq/server_key.pem

# 管理界面SSL配置
# management.tcp.ssl.port = 15671
# management.ssl.cacertfile = /etc/rabbitmq/ca_certificate.pem
# management.ssl.certfile = /etc/rabbitmq/server_certificate.pem
# management.ssl.keyfile = /etc/rabbitmq/server_key.pem

# ===================================================================
# 性能优化
# ===================================================================

# Erlang进程数
# 建议值：CPU核心数
# 默认值：自动检测
# RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS="+A 128"

# IO线程数
# 建议值：CPU核心数或磁盘数
# 默认值：自动检测
# RABBITMQ_IO_THREAD_COUNT = 32

# 消息预取数
# 默认值：0（无限制）
# 建议值：根据业务需求调整
# prefetch_count = 100

# ===================================================================
# 管理界面配置
# ===================================================================

# 管理界面负载间隔（毫秒）
management_agent.disable_metrics_collector = false

# 管理界面采样间隔（毫秒）
management_agent.sample_interval = 60000

# 管理界面采样保留时间（毫秒）
management_agent.retention_sample_time = 3600000

# ===================================================================
# 其他配置
# ===================================================================

# 默认用户和虚拟主机
# 注意：这些配置在Docker环境中通过环境变量设置
# default_user = admin
# default_pass = admin123
# default_vhost = /

# 默认权限配置
# default_permissions.configure = .*
# default_permissions.read = .*
# default_permissions.write = .*

# 循环检测
loopback_users.guest = false

# 系统信息
# true: 允许访问系统信息
# false: 禁止访问系统信息
# 建议值：false（生产环境）
# management.load_definitions = /etc/rabbitmq/definitions.json

# ===================================================================
# 高级配置
# ===================================================================

# 消息压缩
# true: 启用消息压缩
# false: 禁用消息压缩
# 建议值：true（减少网络传输）
# compression.content_encoding = gzip

# 消息压缩阈值（字节）
# 建议值：1024（1KB）
# compression.threshold = 1024

# 延迟消息插件配置
# delayed_message_exchange.enabled = true

# 消息追踪插件配置
# tracing.trace_level = verbose
