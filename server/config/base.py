from pydantic_settings import BaseSettings, SettingsConfigDict


class BaseConfig(BaseSettings):
    """
    全量 Settings 基础配置类（pydantic-settings 2.x）
    """

    model_config = SettingsConfigDict(
        # ==========================================================
        # 一、.env 文件相关
        # ==========================================================
        # 指定要读取的 .env 文件路径
        # 可以是字符串或路径列表
        # 例如：[".env", ".env.local"]
        env_file=".env",
        # .env 文件编码
        # 防止包含中文、特殊字符时报编码错误
        env_file_encoding="utf-8",
        # ==========================================================
        # 二、环境变量读取规则
        # ==========================================================
        # 是否区分环境变量大小写
        # False: DATABASE_URL / database_url 都可以匹配
        # Linux / Docker / K8s 环境强烈建议 False
        case_sensitive=False,
        # 环境变量前缀
        # 例如：env_prefix="APP_"
        # 则只读取 APP_DEBUG / APP_NAME
        # 强烈推荐在多服务项目中使用
        env_prefix="",
        # ==========================================================
        # 三、嵌套 & 复杂结构支持
        # ==========================================================
        # 嵌套字段分隔符
        # 例如：
        # DATABASE__HOST=localhost
        # DATABASE__PORT=3306
        env_nested_delimiter="__",
        # ==========================================================
        # 四、类型校验 & 转换行为
        # ==========================================================
        # 是否启用严格类型模式
        # True : 不允许 "123" -> int
        # False: 会尝试自动转换（默认）
        strict=False,
        # 是否在运行时赋值时进行校验
        # 例如：config.port = "abc" 会直接抛异常
        validate_assignment=True,
        # 是否校验默认值
        # True：字段默认值也必须符合类型
        validate_default=True,
        # Enum 字段是否使用 Enum.value
        # True : Env.dev -> "dev"
        # False: Env.dev -> Env.dev
        use_enum_values=True,
        # ==========================================================
        # 五、字符串处理
        # ==========================================================
        # 是否自动去除字符串首尾空白字符
        # 例如："  abc  " -> "abc"
        str_strip_whitespace=True,
        # ==========================================================
        # 六、多余字段（非常重要）
        # ==========================================================
        # 未在模型中声明的字段如何处理
        # "allow"  : 允许存在（推荐，适合共享 .env）
        # "ignore" : 忽略
        # "forbid" : 直接抛异常（生产环境可用）
        extra="allow",
        # ==========================================================
        # 七、字段别名 & 映射
        # ==========================================================
        # 是否允许通过字段名填充数据
        # 在 alias / env 名称映射时有用
        populate_by_name=True,
        # ==========================================================
        # 八、调试 & 高级行为（一般很少改）
        # ==========================================================
        # 是否允许任意类型（不推荐，除非你很清楚在干什么）
        arbitrary_types_allowed=False,
    )
