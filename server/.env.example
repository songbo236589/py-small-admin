# ===================================================================
# 开发环境配置示例
# ===================================================================
# 使用说明:
# 1. 复制此文件为 .env: cp .env.example .env
# 2. 根据实际情况修改配置
# 3. 不要将 .env 文件提交到版本控制系统
# ===================================================================

# ===================================================================
# 应用基础配置
# ===================================================================

# 应用名称
APP_NAME="Py Small Admin"

# 运行环境
APP_ENV=development

# 调试模式
APP_DEBUG=true

# 应用版本号
APP_VERSION="1.0.0"

# 应用描述
APP_DESCRIPTION="Py Small Admin 服务"

# 服务监听地址
APP_HOST=0.0.0.0

# 服务监听端口
APP_PORT=8009

# 自动重载
APP_RELOAD=true

# API路径前缀
APP_API_PREFIX="/api"

# ===================================================================
# API文档配置
# ===================================================================

# 是否启用API文档
APP_DOCS_ENABLED=true

# Swagger UI文档路径
APP_DOCS_URL="/docs"

# OpenAPI JSON规范路径
APP_OPENAPI_URL="/openapi.json"

# ===================================================================
# 跨域配置 (CORS)
# ===================================================================

# 是否允许所有来源
APP_CORS_ALLOW_ALL=true

# 允许的来源列表
APP_CORS_ORIGINS=["*"]

# 允许的HTTP方法
APP_CORS_METHODS=["*"]

# 允许的请求头
APP_CORS_HEADERS=["*"]

# 时区设置
APP_TIMEZONE="Asia/Shanghai"

# Admin X API Key（请修改为强密钥）
APP_ADMIN_X_API_KEY="CHANGE_THIS_TO_STRONG_KEY"

# ===================================================================
# 默认管理员账号配置
# ===================================================================

# 默认管理员账号（请修改为强密码）
APP_DEFAULT_ADMIN_USERNAME="admin"
APP_DEFAULT_ADMIN_PASSWORD="CHANGE_THIS_TO_STRONG_PASSWORD"

# ===================================================================
# 日志配置
# ===================================================================

# 日志级别
LOG_LEVEL=INFO

# 是否启用控制台日志输出
LOG_CONSOLE=true

# 日志文件路径
LOG_FILE_PATH="logs/{time:YYYY-MM-DD}.log"

# 日志文件轮转时间
LOG_ROTATION="00:00"

# 日志文件保留时间
LOG_RETENTION="30 days"

# 日志文件压缩格式
LOG_COMPRESSION="zip"

# ===================================================================
# 数据库配置
# ===================================================================

# 默认数据库连接
DB_DEFAULT=mysql

# MySQL 连接配置
DB_CONNECTIONS__MYSQL__HOST=127.0.0.1
DB_CONNECTIONS__MYSQL__PORT=3306
DB_CONNECTIONS__MYSQL__DATABASE=fastapi_db
DB_CONNECTIONS__MYSQL__USERNAME=root
DB_CONNECTIONS__MYSQL__PASSWORD=CHANGE_MYSQL_PASSWORD
DB_CONNECTIONS__MYSQL__CHARSET=utf8mb4
DB_CONNECTIONS__MYSQL__COLLATION=utf8mb4_unicode_ci
DB_CONNECTIONS__MYSQL__PREFIX=fa_

# Redis 默认连接配置
DB_REDIS__DEFAULT__HOST=127.0.0.1
DB_REDIS__DEFAULT__PORT=6379
DB_REDIS__DEFAULT__USERNAME=default
DB_REDIS__DEFAULT__PASSWORD=CHANGE_REDIS_PASSWORD
DB_REDIS__DEFAULT__DATABASE=0
DB_REDIS__DEFAULT__PREFIX=redis_default_
DB_REDIS__DEFAULT__MAX_CONNECTIONS=50
DB_REDIS__DEFAULT__RETRY_ON_TIMEOUT=true
DB_REDIS__DEFAULT__SOCKET_TIMEOUT=5
DB_REDIS__DEFAULT__SOCKET_CONNECT_TIMEOUT=5
DB_REDIS__DEFAULT__HEALTH_CHECK_INTERVAL=30

# Redis 缓存连接配置
DB_REDIS__CACHE__HOST=127.0.0.1
DB_REDIS__CACHE__PORT=6379
DB_REDIS__CACHE__USERNAME=default
DB_REDIS__CACHE__PASSWORD=CHANGE_REDIS_PASSWORD
DB_REDIS__CACHE__DATABASE=1
DB_REDIS__CACHE__PREFIX=cache_
DB_REDIS__CACHE__MAX_CONNECTIONS=50
DB_REDIS__CACHE__RETRY_ON_TIMEOUT=true
DB_REDIS__CACHE__SOCKET_TIMEOUT=5
DB_REDIS__CACHE__SOCKET_CONNECT_TIMEOUT=5
DB_REDIS__CACHE__HEALTH_CHECK_INTERVAL=30

# ===================================================================
# 缓存配置
# ===================================================================

CACHE_CONNECTION=cache
CACHE_DEFAULT_TTL=31536000
CACHE_KEY_PREFIX=cache

# ===================================================================
# 密码配置
# ===================================================================

PWD_PASSWORD_SCHEMES=["bcrypt"]
PWD_PASSWORD_DEFAULT_SCHEME="bcrypt"
PWD_PASSWORD_DEPRECATED="auto"
PWD_BCRYPT_ROUNDS=12
PWD_BCRYPT_IDENT="2b"
PWD_BCRYPT_SALT_SIZE=22
PWD_BCRYPT_TRUNCATE_ERROR=False

# ===================================================================
# JWT认证配置
# ===================================================================

# JWT密钥（请修改为强密钥，至少32字符）
JWT_SECRET_KEY="CHANGE_THIS_TO_VERY_STRONG_SECRET_KEY_AT_LEAST_32_CHARACTERS_LONG"
JWT_ALGORITHM="HS256"
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7
JWT_ISSUER="fast-api-admin"
JWT_AUDIENCE="fast-client-admin"
JWT_VERIFY_EXPIRATION=true
JWT_VERIFY_ISSUER=true
JWT_VERIFY_AUDIENCE=true
JWT_ACCESS_TOKEN_TYPE="access"
JWT_REFRESH_TOKEN_TYPE="refresh"
JWT_ENABLE_BLACKLIST=true
JWT_BLACKLIST_PREFIX="jwt:blacklist:admin:"

# ===================================================================
# 验证码配置
# ===================================================================

CAPTCHA_LENGTH=4
CAPTCHA_WIDTH=120
CAPTCHA_HEIGHT=50
CAPTCHA_FONT_SIZE=28
CAPTCHA_CHAR_TYPE=alphanumeric
CAPTCHA_FONT_PATH=""
CAPTCHA_BACKGROUND_COLOR="[255,255,255]"
CAPTCHA_TEXT_COLOR="[0,0,0]"
CAPTCHA_NOISE_LINE_COUNT=2
CAPTCHA_NOISE_POINT_COUNT=100
CAPTCHA_NOISE_LINE_COLOR_RANGE="[[100,200],[100,200],[100,200]]"
CAPTCHA_NOISE_POINT_COLOR_RANGE="[[150,255],[150,255],[150,255]]"
CAPTCHA_DISTORTION=true
CAPTCHA_DISTORTION_LEVEL=0.1
CAPTCHA_EXPIRE_SECONDS=300
CAPTCHA_REDIS_KEY_PREFIX=captcha:
CAPTCHA_DEFAULT_TYPE=image

# ===================================================================
# 文件上传配置
# ===================================================================

UPLOAD_DIR="./uploads"
UPLOAD_URL_PREFIX="/uploads"
UPLOAD_FILENAME_RULE="uuid"
UPLOAD_PATH_RULE="Y-m-d"

# ===================================================================
# 阿里云 OSS 配置
# ===================================================================

UPLOAD_OSS_ACCESS_KEY_ID=""
UPLOAD_OSS_ACCESS_KEY_SECRET=""
UPLOAD_OSS_REGION="oss-cn-hangzhou"
UPLOAD_OSS_BUCKET=""
UPLOAD_OSS_ENDPOINT=""
UPLOAD_OSS_INTERNAL_ENDPOINT=""
UPLOAD_OSS_CDN_DOMAIN=""

# ===================================================================
# 腾讯云 COS 配置
# ===================================================================

UPLOAD_COS_SECRET_ID=""
UPLOAD_COS_SECRET_KEY=""
UPLOAD_COS_REGION="ap-guangzhou"
UPLOAD_COS_BUCKET=""
UPLOAD_COS_ENDPOINT=""
UPLOAD_COS_CDN_DOMAIN=""

# ===================================================================
# 七牛云 Kodo 配置
# ===================================================================

UPLOAD_KODO_ACCESS_KEY=""
UPLOAD_KODO_SECRET_KEY=""
UPLOAD_KODO_BUCKET=""
UPLOAD_KODO_REGION="z0"
UPLOAD_KODO_DOMAIN=""

# ===================================================================
# Celery + RabbitMQ 配置
# ===================================================================

# ========== Broker 配置 ==========

# 消息代理 URL（请修改密码）
CELERY_BROKER_URL="amqp://admin:CHANGE_RABBITMQ_PASSWORD@localhost:5672//"

# 连接失败时是否自动重试
CELERY_BROKER_CONNECTION_RETRY=true

# 启动时连接失败是否重试
CELERY_BROKER_CONNECTION_RETRY_ON_STARTUP=true

# 最大重试次数
CELERY_BROKER_CONNECTION_MAX_RETRIES=5

# 重试延迟时间（秒）
CELERY_BROKER_CONNECTION_RETRY_DELAY=5

# 是否使用 SSL 连接 RabbitMQ
CELERY_BROKER_USE_SSL=false

# Broker 传输选项
CELERY_BROKER_TRANSPORT_OPTIONS={"heartbeat": 60, "socket_timeout": 30, "socket_keepalive": true}

# ========== Result Backend 配置 ==========

# 任务结果存储 URL（请修改密码）
CELERY_RESULT_BACKEND="redis://default:CHANGE_REDIS_PASSWORD@127.0.0.1:6379/0"

# 任务结果过期时间（秒）
CELERY_RESULT_EXPIRES=3600

# 是否扩展结果格式
CELERY_RESULT_EXTENDED=true

# Result Backend 传输选项
CELERY_RESULT_BACKEND_TRANSPORT_OPTIONS={}

# ========== Worker 配置 ==========

# Worker 执行池类型
CELERY_WORKER_POOL=threads

# Worker 并发数
CELERY_WORKER_CONCURRENCY=4

# 预取倍数
CELERY_WORKER_PREFETCH_MULTIPLIER=4

# 每个 Worker 处理的最大任务数
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# 是否禁用速率限制
CELERY_WORKER_DISABLE_RATE_LIMITS=false

# Worker 日志格式
CELERY_WORKER_LOG_FORMAT="[%(asctime)s: %(levelname)s/%(processName)s] %(message)s"

# Worker 任务日志格式
CELERY_WORKER_TASK_LOG_FORMAT="[%(asctime)s: %(levelname)s/%(processName)s] [%(task_name)s(%(task_id)s)] %(message)s"

# Worker 日志级别
CELERY_WORKER_LOGLEVEL=INFO

# ========== 任务配置 ==========

# 默认队列名称
CELERY_TASK_DEFAULT_QUEUE=default

# 默认交换机名称
CELERY_TASK_DEFAULT_EXCHANGE=default

# 默认路由键
CELERY_TASK_DEFAULT_ROUTING_KEY=default

# 默认速率限制
CELERY_TASK_DEFAULT_RATE_LIMIT=""

# 默认硬超时时间（秒）
CELERY_TASK_DEFAULT_TIME_LIMIT=3600

# 默认软超时时间（秒）
CELERY_TASK_DEFAULT_SOFT_TIME_LIMIT=3000

# 默认最大重试次数
CELERY_TASK_DEFAULT_MAX_RETRIES=3

# 默认重试延迟（秒）
CELERY_TASK_DEFAULT_RETRY_DELAY=60

# 是否跟踪任务开始时间
CELERY_TASK_TRACK_STARTED=true

# 是否延迟确认
CELERY_TASK_ACKS_LATE=true

# Worker 丢失时是否拒绝任务
CELERY_TASK_REJECT_ON_WORKER_LOST=true

# 是否同步执行任务（仅用于测试）
CELERY_TASK_ALWAYS_EAGER=false

# 同步执行时是否传播异常
CELERY_TASK_EAGER_PROPAGATES=true

# ========== 序列化配置 ==========

# 任务序列化格式
CELERY_TASK_SERIALIZER=json

# 结果序列化格式
CELERY_RESULT_SERIALIZER=json

# 接受的内容类型列表
CELERY_ACCEPT_CONTENT=["json"]

# ========== 时区配置 ==========

CELERY_TIMEZONE="Asia/Shanghai"
CELERY_ENABLE_UTC=true

# ========== 安全配置 ==========

CELERY_TASK_SEND_SENT_EVENT=true
CELERY_TASK_SEND_STARTED_EVENT=true
CELERY_TASK_SEND_SUCCESS_EVENT=true
CELERY_TASK_SEND_FAILURE_EVENT=true
CELERY_TASK_SEND_RETRY_EVENT=true

# ========== Celery Beat 配置 ==========

CELERY_BEAT_SCHEDULE_FILENAME=celerybeat-schedule
CELERY_BEAT_MAX_LOOP_INTERVAL=5
CELERY_BEAT_LOGLEVEL=INFO
CELERY_BEAT_SCHEDULER=redbeat.RedBeatScheduler

# ========== Flower 监控配置 ==========

CELERY_FLOWER_PORT=5555
CELERY_FLOWER_HOST=0.0.0.0
# Flower 基本认证（请修改密码）
CELERY_FLOWER_BASIC_AUTH="admin:CHANGE_FLOWER_PASSWORD"
CELERY_FLOWER_BROKER_API="http://localhost:15672/api/"

# ========== 任务模块配置 ==========

CELERY_INCLUDE_JSON='["Modules.admin.tasks.default_tasks", "Modules.admin.queues.email_queues", "Modules.quant.queues.concept_queues", "Modules.quant.queues.industry_queues", "Modules.quant.queues.stock_queues"]'

# ========== 定时任务配置 ==========

CELERY_BEAT_SCHEDULE_JSON='{"task_print_hello": {"task": "Modules.admin.tasks.default_tasks.print_hello_task", "schedule": 60.0}}'

# ========== 任务队列配置 ==========

CELERY_TASK_QUEUES_JSON='[{"name": "default", "exchange": "default", "routing_key": "default"}, {"name": "email_queues", "exchange": "email_queues", "routing_key": "email_queues"},{"name": "quant_concept_queues", "exchange": "quant_concept_queues", "routing_key": "quant_concept_queues"},{"name": "quant_industry_queues", "exchange": "quant_industry_queues", "routing_key": "quant_industry_queues"},{"name": "quant_stock_queues", "exchange": "quant_stock_queues", "routing_key": "quant_stock_queues"}]'

# 任务路由配置
CELERY_TASK_ROUTES='{"Modules.admin.queues.email_queues.send_batch_email_queue": {"queue": "email_queues"},"Modules.quant.queues.concept_queues.sync_concept_relation_queue": {"queue": "quant_concept_queues"},"Modules.quant.queues.industry_queues.sync_industry_relation_queue": {"queue": "quant_industry_queues"},"Modules.quant.queues.stock_queues.sync_stock_kline_1d_queue": {"queue": "quant_stock_queues"}}'

# ========== 其他配置 ==========

CELERY_TASK_COMPRESSION=""
CELERY_TASK_COMPRESSION_THRESHOLD=1024
CELERY_RESULT_COMPRESSION=""
CELERY_RESULT_COMPRESSION_THRESHOLD=1024

# ========== FastAPI 集成配置 ==========

CELERY_VERIFY_ON_STARTUP=true

