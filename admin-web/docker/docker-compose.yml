# ===================================================================
# Docker Compose 配置文件 - 前端开发环境
# ===================================================================
# 使用说明:
# 1. 确保后端服务已启动（在 ../server/docker 目录下运行 docker-compose up -d）
# 2. 启动前端开发环境: docker-compose up -d
# 3. 查看日志: docker-compose logs -f
# 4. 停止服务: docker-compose down
# 5. 重新构建: docker-compose build --no-cache
# ===================================================================

version: '3.8'

services:
  # ========================================
  # 前端开发服务
  # ========================================
  admin-web-dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile.dev
    container_name: admin-web-dev
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      # 挂载源代码，支持热更新
      - ../src:/app/src
      - ../config:/app/config
      - ../public:/app/public
      - ../package.json:/app/package.json
      - ../tsconfig.json:/app/tsconfig.json
      # 避免挂载 node_modules，使用容器内的
      - /app/node_modules
    environment:
      NODE_ENV: development
      UMI_ENV: dev
      UMI_APP_ENV: dev
      UMI_APP_API_BASE_URL: http://fastapi:8009
      UMI_APP_API_KEY: "123456"
      # 禁用 mock，使用真实后端
      MOCK: none
    networks:
      - py-small-admin-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    # 开发环境不限制资源
    stdin_open: true
    tty: true

# ========================================
# 网络定义
# ========================================
networks:
  py-small-admin-network:
    external: true
    name: py-small-admin-network
